<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MUHASABAH || Ridho Sandhika</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #00ff41;
            --dim-green: #008F11;
            --black: #050505;
            --glow: 0 0 10px var(--green), 0 0 20px var(--green);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            height: 100vh;
            height: 100dvh;
            font-family: 'VT323', monospace;
            background-color: var(--black);
            color: var(--green);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: text;

            /* --- ANTI COPY PASTE CSS --- */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* --- CRT MONITOR EFFECTS --- */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .crt::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.6) 100%);
            z-index: 2;
            pointer-events: none;
        }

        canvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 0;
            opacity: 0.15;
        }

        /* --- MAIN TERMINAL --- */
        .terminal-container {
            position: relative;
            z-index: 5;
            width: 95%;
            max-width: 700px;
            height: auto;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .terminal-window {
            background: rgba(0, 10, 0, 0.9);
            border: 1px solid var(--dim-green);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
            padding: 20px;
            position: relative;
            min-height: 300px;
            border-radius: 5px;
            transition: all 0.2s;
            overflow-y: auto;
        }

        .terminal-window:hover, .terminal-window:focus-within {
            box-shadow: var(--glow);
            border-color: var(--green);
        }

        /* Typography */
        h2, h1 {
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0px var(--dim-green);
            font-size: clamp(1.5rem, 5vw, 2.5rem);
        }

        p, span, div {
            font-size: clamp(1rem, 3vw, 1.2rem);
        }

        /* GLITCH TEXT */
        .glitch-text { position: relative; }
        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            opacity: 0.8;
        }
        .glitch-text::before {
            color: #ff00c1; z-index: -1;
            animation: glitch-anim-1 2s infinite linear alternate-reverse;
        }
        .glitch-text::after {
            color: #00fff9; z-index: -2;
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim-1 {
            0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px,0); }
            100% { clip-path: inset(10% 0 50% 0); transform: translate(-2px,0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip-path: inset(10% 0 60% 0); transform: translate(2px,0); }
            100% { clip-path: inset(80% 0 5% 0); transform: translate(-2px,0); }
        }

        /* INPUTS */
        .input-line {
            display: flex;
            align-items: flex-start;
            margin-top: 20px;
            border-left: 2px solid var(--dim-green);
            padding-left: 10px;
            transition: 0.3s;
        }
        .input-line:focus-within {
            border-left: 2px solid var(--green);
            box-shadow: -5px 0 10px -5px var(--green);
        }
        .prompt { 
            margin-right: 5px; 
            color: var(--green); 
            white-space: nowrap; 
            padding-top: 2px;
            font-size: clamp(0.9rem, 3vw, 1.2rem);
        }
        
        input, textarea {
            background: transparent; border: none; color: var(--green);
            font-family: 'VT323', monospace; 
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            width: 100%;
            outline: none; text-shadow: 0 0 5px var(--dim-green);
            -webkit-user-select: text;
            user-select: text;
        }
        textarea { height: 100px; resize: none; line-height: 1.2; }

        .btn-hack {
            margin-top: 20px; background: transparent; border: 1px solid var(--green);
            color: var(--green); padding: 12px 20px;
            font-family: 'VT323', monospace;
            font-size: 1.2rem; cursor: pointer; text-transform: uppercase;
            width: 100%; position: relative; overflow: hidden; transition: 0.2s;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-hack::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%; background: var(--green); z-index: -1; transition: 0.3s;
        }
        .btn-hack:hover, .btn-hack:active { color: black; box-shadow: 0 0 20px var(--green); }
        .btn-hack:hover::before, .btn-hack:active::before { left: 0; }

        .hidden { display: none !important; }
        .cursor {
            display: inline-block; width: 10px; height: 1.2em;
            background: var(--green); animation: blink 1s step-end infinite;
            vertical-align: text-bottom;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* BOOT SCREEN */
        #boot-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 100; padding: 20px; box-sizing: border-box;
            font-size: 1rem; display: flex; flex-direction: column; justify-content: flex-start;
            overflow-y: auto;
        }
        .boot-line { margin: 2px 0; color: #ccc; word-wrap: break-word;}
        .success { color: var(--green); }

        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 999;
            display: flex; justify-content: center; align-items: center; flex-direction: column; cursor: pointer;
            padding: 20px; text-align: center;
        }
        #start-overlay h1 { font-size: clamp(2rem, 8vw, 4rem); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; text-shadow: 0 0 20px var(--green); } }

        .progress-bar {
            width: 100%; height: 15px; border: 1px solid var(--dim-green);
            margin: 15px 0; padding: 2px; display: none;
        }
        .progress-fill {
            height: 100%; background: var(--green); width: 0%; transition: width 0.1s;
        }

        .sys-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.8);
            text-align: center;
            font-size: 0.9rem;
            color: var(--dim-green);
            z-index: 10;
            pointer-events: auto;
            padding: 8px 0;
            text-shadow: 0 0 2px var(--dim-green);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .sys-footer a {
            color: var(--green);
            text-decoration: none;
            font-weight: bold;
            border-bottom: 1px dashed var(--dim-green);
            transition: 0.3s;
            padding: 0 5px;
        }
        
        @media (max-height: 500px) {
            .terminal-container { height: 100vh; justify-content: flex-start; padding-top: 10px;}
            .terminal-window { max-height: 80vh; }
            .sys-footer { position: static; margin-top: 10px;}
        }
    </style>
</head>
<body class="crt">

    <canvas id="c"></canvas>

    <div id="start-overlay" onclick="startSystem()">
        <h1 class="glitch-text" data-text="[ SYSTEM_INIT ]">[ SYSTEM_INIT ]</h1>
        <p style="opacity: 0.7; font-size: 1rem;">Tap Anywhere to Start<br>Sound On Recommended</p>
    </div>

    <div id="boot-screen" class="hidden">
        <div id="boot-log"></div>
    </div>

    <div class="terminal-container hidden" id="main-interface">
        <div class="terminal-window">
            <div style="display: flex; justify-content: space-between; border-bottom: 1px dashed var(--dim-green); padding-bottom: 10px; margin-bottom: 20px; font-size: 0.9rem;">
                <span>ROOT@QALB:~/SCAN</span>
                <span id="clock">00:00:00</span>
            </div>

            <div id="step1">
                <h2 class="glitch-text" data-text="VERIFY_IDENTITY">VERIFY_IDENTITY</h2>
                <p id="type-text-1" style="min-height: 20px;"></p>
                <div class="input-line">
                    <span class="prompt">guest@user:~$</span>
                    <input type="text" id="inputNama" placeholder="Ketik Nama..." autocomplete="off">
                </div>
                <button class="btn-hack" onclick="nextStep()">[ START_SESSION ]</button>
            </div>

            <div id="step2" class="hidden">
                <p>>> SUBJECT: <span id="namaDisplay" style="color:white; font-weight:bold;">UNKNOWN</span></p>
                <p>>> SECURITY: <span style="color: var(--green);">ENCRYPTED</span></p>
                
                <div class="progress-bar" id="loadBar">
                    <div class="progress-fill" id="loadFill"></div>
                </div>

                <div id="question-container" class="hidden">
                    <br>
                    <p style="background: var(--dim-green); color: black; display: inline-block; padding: 0 5px; font-size: 0.9rem;">
                        [ DEEP_QUERY_V.2 <span id="qCount"></span> ]
                    </p>
                    <div id="questionText" style="font-size: clamp(1.1rem, 4vw, 1.5rem); margin: 15px 0; min-height: 60px; line-height: 1.3;"></div>
                    
                    <div class="input-line">
                        <span class="prompt">>></span>
                        <textarea id="inputPesan" placeholder="Jawab jujur di sini..."></textarea>
                    </div>
                    <button class="btn-hack" id="btnKirim">[ SEND_TRUTH ]</button>
                </div>
            </div>

            <div id="step3" class="hidden">
                <h1 style="text-align: center;" class="glitch-text" data-text="DATA SAVED">DATA SAVED</h1>
                <br>
                <p style="text-align: center;">"Hisablah dirimu sebelum kamu dihisab."</p>
                <br>
                <div style="text-align: center; border: 1px solid var(--dim-green); padding: 10px;">
                    <p style="margin:0; font-size: 0.9rem;">Semua jawaban telah tersimpan.</p>
                    <p style="margin:0; font-size: 0.9rem;">Jazakumullah Khairan.</p>
                    <p style="margin:0; font-size: 0.9rem;">CONNECTION: CLOSED</p>
                </div>
                <button class="btn-hack" onclick="location.reload()">[ REBOOT ]</button>
            </div>
        </div>
        
        <div class="sys-footer" style="position: static; margin-top: 15px; background: transparent;">
            © 2025 [ V:2.1 ] - Made by: <a href="https://www.instagram.com/ridhosandhika_?igsh=MW9laWY4aDZhdWJsOQ==a" target="_blank">Ridho Sandhika</a>
        </div>
    </div>


    <script type="module">
        // --- FIREBASE CONFIG ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD4SV7gSqF5DC9V5JWzYynb84iBWT_UWUI",
            authDomain: "bsjdudi-4037e.firebaseapp.com",
            projectId: "bsjdudi-4037e",
            storageBucket: "bsjdudi-4037e.firebasestorage.app",
            messagingSenderId: "307784955148",
            appId: "1:307784955148:web:70f1f51da8a38e44344529",
            measurementId: "G-G6FQBWF5CC"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch(e) { console.log("Demo Mode"); }

        // --- AUDIO ENGINE ---
        let audioCtx;
        function initAudio() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }
        function playTone(freq, type, duration) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.value = freq;
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }
        function playKeySound() { playTone(600 + Math.random() * 200, 'square', 0.05); }

        // --- SECURITY ---
        document.addEventListener("contextmenu", function(e){
            e.preventDefault(); playTone(150, 'sawtooth', 0.2); return false;
        });
        document.addEventListener("keydown", function(e) {
            if (e.ctrlKey && (e.key === "c" || e.key === "C" || e.key === "v" || e.key === "V" || e.key === "u" || e.key === "U")) {
                e.preventDefault(); playTone(150, 'sawtooth', 0.2); return false;
            }
            if(e.keyCode == 123) { e.preventDefault(); return false; }
        });

        // --- VISUALS ---
        const c = document.getElementById("c");
        const ctx = c.getContext("2d");
        
        function resizeCanvas() { c.height = window.innerHeight; c.width = window.innerWidth; }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const matrixChars = "01ﾊﾐﾋｰｳｼﾅﾓﾆｻﾜﾂｵﾘｱﾎﾃﾏｹﾒｴｶｷﾑﾕﾗｾﾈｽﾀﾇﾍ";
        const font_size = 14; 
        let columns = c.width/font_size; let drops = [];
        function initMatrix() { columns = c.width/font_size; drops = []; for(let x = 0; x < columns; x++) drops[x] = 1; }
        initMatrix();
        window.addEventListener('resize', initMatrix);

        function drawMatrix() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)"; ctx.fillRect(0, 0, c.width, c.height);
            ctx.fillStyle = "#0F0"; ctx.font = font_size + "px monospace";
            for(let i = 0; i < drops.length; i++) {
                const text = matrixChars[Math.floor(Math.random()*matrixChars.length)];
                ctx.fillText(text, i*font_size, drops[i]*font_size);
                if(drops[i]*font_size > c.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 40);
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('id-ID'); }, 1000);

        // --- SYSTEM FLOW ---
        window.startSystem = function() {
            initAudio();
            document.getElementById('start-overlay').classList.add('hidden');
            document.getElementById('boot-screen').classList.remove('hidden');
            runBootSequence();
        }

        async function runBootSequence() {
            const logs = ["Initializing Qalb Monitor...", "Checking Niat purity...", "Scanning for Riya' & Sum'ah...", "Accessing file: /root/dosa_masa_lalu...", "System Online."];
            const bootLog = document.getElementById('boot-log');
            for (let i = 0; i < logs.length; i++) {
                playKeySound();
                const p = document.createElement('div');
                p.className = 'boot-line'; p.innerHTML = `[ <span class="success">OK</span> ] ${logs[i]}`;
                bootLog.appendChild(p);
                bootLog.scrollTop = bootLog.scrollHeight;
                await new Promise(r => setTimeout(r, 400));
            }
            setTimeout(() => {
                document.getElementById('boot-screen').classList.add('hidden');
                document.getElementById('main-interface').classList.remove('hidden');
                playTone(100, 'sawtooth', 1.0);
                typeWriter("Identitas diperlukan...", "type-text-1", 30);
            }, 800);
        }

        function typeWriter(text, elementId, speed) {
            let i = 0; const el = document.getElementById(elementId); el.innerHTML = "";
            function type() {
                if (i < text.length) { el.innerHTML += text.charAt(i); playKeySound(); i++; setTimeout(type, speed); }
                else { el.innerHTML += '<span class="cursor"></span>'; }
            }
            type();
        }

        document.querySelectorAll('input, textarea').forEach(el => {
            el.addEventListener('keydown', () => playTone(800, 'square', 0.03));
        });

        // --- PERTANYAAN (SEMUA AKAN DITAMPILKAN) ---
        const hardQuestions = [
            "Adakah perkataan atau perilakuku yang pernah menyakiti hatimu, baik sengaja maupun tidak? Tolong beritahu aku.",
            "Jujur, apakah aku sering terlihat 'alim' di sosmed, tapi aslinya jauh dari sunnah saat kita bertemu?",
            "Saat kita berkumpul, apakah aku orang yang sering memancing ghibah (gosip) daripada mengajak mengingat Allah?",
            "Jika aku wafat hari ini, adakah hakmu (janji/hutang/barang) yang masih tertahan padaku dan belum aku ikhlaskan?",
            "Menurutmu, apakah gaya hidupku saat ini membuatku terlihat mencintai dunia (Wahn) dan melupakan persiapan mati?",
            "Apakah ibadah/kebaikan yang sering kuposting terlihat ikhlas, atau terkesan Riya' (ingin dipuji) di matamu?",
            "Sebutkan satu dosa/keburukan terbesarku yang selama ini kau tutup-tutupi karena tidak enak menegurku."
            "Tinggalkan Pesan berharga untuk saya,  agar saya merubah sifat/sikap/tingkah laku"
        ];

        let namaUser = ""; 
        let currentQuestion = "";
        let currentQuestionIndex = 0; // Index pertanyaan saat ini

        window.nextStep = function() {
            const nama = document.getElementById('inputNama').value;
            if(!nama) { playTone(150, 'sawtooth', 0.3); document.getElementById('inputNama').focus(); return; }

            playTone(1200, 'sine', 0.1);
            namaUser = nama;
            document.getElementById('namaDisplay').innerText = nama.toUpperCase();
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');

            const loadBar = document.getElementById('loadBar');
            const loadFill = document.getElementById('loadFill');
            loadBar.style.display = 'block';
            
            setTimeout(() => { loadFill.style.width = "40%"; playKeySound(); }, 200);
            setTimeout(() => { loadFill.style.width = "100%"; playKeySound(); }, 1200);

            setTimeout(() => {
                loadBar.style.display = 'none';
                document.getElementById('question-container').classList.remove('hidden');
                
                // Mulai pertanyaan pertama
                currentQuestionIndex = 0;
                displayCurrentQuestion();

            }, 1500);
        }

        // Fungsi baru untuk menampilkan pertanyaan berdasarkan Index
        function displayCurrentQuestion() {
            if (currentQuestionIndex < hardQuestions.length) {
                currentQuestion = hardQuestions[currentQuestionIndex];
                
                // Update counter di UI (misal: 1/7)
                document.getElementById('qCount').innerText = `[${currentQuestionIndex + 1}/${hardQuestions.length}]`;
                
                // Bersihkan input sebelumnya
                document.getElementById('inputPesan').value = "";
                
                // Efek ketik
                typeWriter(currentQuestion, "questionText", 35);
            } else {
                // Jika sudah habis semua pertanyaan
                finishSession();
            }
        }

        function finishSession() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            playTone(440, 'sine', 0.5);
        }

        document.getElementById('btnKirim').addEventListener('click', async () => {
            const pesan = document.getElementById('inputPesan').value;
            const btn = document.getElementById('btnKirim');
            
            // Validasi input tidak boleh kosong
            if(!pesan) { playTone(150, 'sawtooth', 0.3); return; }
            
            playTone(1000, 'square', 0.1);
            btn.innerText = "[ SAVING... ]";
            btn.disabled = true; // Cegah double click
            
            try {
                if(db) {
                    await addDoc(collection(db, "pesan_jujur"), {
                        nama_pengirim: namaUser, 
                        pertanyaan: currentQuestion, 
                        isi_pesan: pesan,
                        waktu: serverTimestamp(), 
                        tema: "muhasabah_hard",
                        urutan: currentQuestionIndex + 1
                    });
                } else {
                    await new Promise(r => setTimeout(r, 800)); // Simulasi delay demo
                }

                // LANJUT KE PERTANYAAN BERIKUTNYA
                btn.innerText = "[ SEND_TRUTH ]";
                btn.disabled = false;
                currentQuestionIndex++; // Naik ke pertanyaan selanjutnya
                displayCurrentQuestion(); // Tampilkan

            } catch (e) {
                alert("ERROR: Gagal terhubung ke database/internet.");
                btn.innerText = "[ RETRY ]";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
